<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Friends Chat</title>

<style>
body{font-family:sans-serif;margin:0;background:#e5ddd5;display:flex;justify-content:center;align-items:center;height:100vh}
.card{background:white;width:100%;max-width:400px;height:100vh;display:flex;flex-direction:column}
header{background:#075e54;color:white;padding:15px;font-weight:bold}
#chat{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column}
.msg{margin:5px 0;padding:10px;border-radius:15px;max-width:70%}
.me{background:#dcf8c6;align-self:flex-end}
.them{background:white;align-self:flex-start}
.input-area{display:flex;padding:10px;background:#f0f0f0}
input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc}
button{background:#25d366;color:white;border:none;padding:10px 15px;border-radius:20px;margin-left:5px}
</style>
</head>
<body>

<div class="card">
<header id="roomTitle">Room</header>
<div id="chat"></div>
<div class="input-area">
<input id="msgInput" placeholder="Message..." onkeypress="if(event.key==='Enter')sendMsg()">
<button onclick="sendMsg()">Send</button>
</div>
</div>

<script>
const BIN_ID = "69956e3c43b1c97be987d4e6";
const API_KEY = "$2a$10$yfzcDWcZY6VdYg.R4RkmS.8mmppM2hyJrou3Jmn2ymiYT5f0B7CR6";
const BASE_URL = "https://api.jsonbin.io/v3/b/" + "69956e3c43b1c97be987d4e6";

let user = prompt("Your Name?");
let room = prompt("Room Name?").toLowerCase();
document.getElementById("roomTitle").textContent = room;

async function getData() {
  const res = await fetch(BASE_URL + "/latest", {
    headers: { "X-Master-Key": API_KEY }
  });
  const data = await res.json();
  return data.record;
}

async function saveData(data) {
  await fetch(BASE_URL, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY
    },
    body: JSON.stringify(data)
  });
}

async function sendMsg() {
  const input = document.getElementById("msgInput");
  if (!input.value.trim()) return;

  let data = await getData();

  if (!data.rooms[room]) {
    data.rooms[room] = [];
  }

  data.rooms[room].push({
    user: user,
    text: input.value,
    time: Date.now()
  });

  await saveData(data);

  input.value = "";
  loadMessages();
}

async function loadMessages() {
  let data = await getData();
  const chat = document.getElementById("chat");
  chat.innerHTML = "";

  if (!data.rooms[room]) return;

  data.rooms[room].forEach(msg => {
    const div = document.createElement("div");
    div.className = "msg " + (msg.user === user ? "me" : "them");
    div.innerHTML = "<b style='font-size:10px'>" + msg.user + "</b><br>" + msg.text;
    chat.appendChild(div);
  });

  chat.scrollTop = chat.scrollHeight;
}

setInterval(loadMessages, 2000);
loadMessages();
</script>

</body>
</html>
